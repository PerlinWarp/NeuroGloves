import numpy as np
import matplotlib.pyplot as plt
from matplotlib import animation
from mpl_toolkits.mplot3d import Axes3D
import mpl_toolkits.mplot3d as plt3d

'''
Example glb from OpenGloves, originally from steamvr/drivers/indexcontroller
0 RootNode, 
1 REF:Root, 
2 REF:wrist_r, # All metacarpal positons are relative to this. 
3 REF:finger_thumb_0_r, 
4 REF:finger_thumb_1_r,
5 REF:finger_thumb_2_r,
6 REF:finger_thumb_r_end,
7 REF:finger_index_meta_r - -0.000632452196441591, 0.0268661547452211, 0.01500194799155
8 REF:finger_index_0_r
9 REF:finger_index_1_r
10 REF:finger_index_2_r
11 REF:finger_index_r_end
12 REF:finger_middle_meta_r  -0.00217731343582273, 0.00711954385042191, 0.0163187384605408
13 REF:finger_middle_0_r
14 REF:finger_middle_1_r
15 REF:finger_middle_2_r
16 REF:finger_middle_r_end
17 REF:finger_ring_meta_r -0.000513435574248433, -0.00654512271285057, 0.0163476932793856
18 REF:finger_ring_0_r
19 REF:finger_ring_1_r
20 REF:finger_ring_2_r
21 REF:finger_ring_r_end
22 REF:finger_pinky_meta_r 0.00247815088368952, -0.0189813692122698, 0.0152135835960507
23 REF:finger_pinky_0_r
24 REF:finger_pinky_1_r
25 REF:finger_pinky_2_r
26 REF:finger_pinky_r_end
27 REF:finger_thumb_r_aux -0.00605911063030362, 0.0562852211296558, -0.0600638426840305
28 REF:finger_index_r_aux
29 REF:finger_middle_r_aux
30 REF:finger_ring_r_aux
31 REF:finger_pinky_r_aux
'''

right_pose = np.array([
    # Position (x,y,z,1) , Quaternion ()
    [[0.000000, 0.000000, 0.000000, 1.000000], [1.000000, -0.000000, -0.000000, 0.000000]],
    [[0.034038, 0.036503, 0.164722, 1.000000], [-0.055147, -0.078608, 0.920279, -0.379296]], # Wrist
    [[0.012083, 0.028070, 0.025050, 1.000000], [0.567418, -0.464112, 0.623374, -0.272106]], # Thumb Meta
    [[-0.040406, -0.000000, 0.000000, 1.000000], [0.994838, 0.082939, 0.019454, 0.055130]],
    [[-0.032517, -0.000000, -0.000000, 1.000000], [0.974793, -0.003213, 0.021867, -0.222015]],
    [[-0.030464, 0.000000, 0.000000, 1.000000], [1.000000, -0.000000, -0.000000, 0.000000]],
    [[-0.000632, 0.026866, 0.015002, 1.000000], [0.421979, -0.644251, 0.422133, 0.478202]], # Index Meta
    [[-0.074204, 0.005002, -0.000234, 1.000000], [0.995332, 0.007007, -0.039124, 0.087949]],
    [[-0.043930, 0.000000, 0.000000, 1.000000], [0.997891, 0.045808, 0.002142, -0.045943]],
    [[-0.028695, -0.000000, -0.000000, 1.000000], [0.999649, 0.001850, -0.022782, -0.013409]],
    [[-0.022821, -0.000000, 0.000000, 1.000000], [1.000000, -0.000000, 0.000000, -0.000000]],
    [[-0.002177, 0.007120, 0.016319, 1.000000], [0.541276, -0.546723, 0.460749, 0.442520]], # Middle Meta
    [[-0.070953, -0.000779, -0.000997, 1.000000], [0.980294, -0.167261, -0.078959, 0.069368]],
    [[-0.043108, -0.000000, -0.000000, 1.000000], [0.997947, 0.018493, 0.013192, 0.059886]],
    [[-0.033266, -0.000000, -0.000000, 1.000000], [0.997394, -0.003328, -0.028225, -0.066315]],
    [[-0.025892, 0.000000, -0.000000, 1.000000], [0.999195, -0.000000, 0.000000, 0.040126]],
    [[-0.000513, -0.006545, 0.016348, 1.000000], [0.550143, -0.516692, 0.429888, 0.495548]], # Ring Meta
    [[-0.065876, -0.001786, -0.000693, 1.000000], [0.990420, -0.058696, -0.101820, 0.072495]],
    [[-0.040697, -0.000000, -0.000000, 1.000000], [0.999545, -0.002240, 0.000004, 0.030081]],
    [[-0.028747, 0.000000, 0.000000, 1.000000], [0.999102, -0.000721, -0.012693, 0.040420]],
    [[-0.022430, 0.000000, -0.000000, 1.000000], [1.000000, 0.000000, 0.000000, 0.000000]], 
    [[0.002478, -0.018981, 0.015214, 1.000000], [0.523940, -0.526918, 0.326740, 0.584025]], # Pinky Meta
    [[-0.062878, -0.002844, -0.000332, 1.000000], [0.986609, -0.059615, -0.135163, 0.069132]],
    [[-0.030220, -0.000000, -0.000000, 1.000000], [0.994317, 0.001896, -0.000132, 0.106446]],
    [[-0.018187, -0.000000, -0.000000, 1.000000], [0.995931, -0.002010, -0.052079, -0.073526]],
    [[-0.018018, -0.000000, 0.000000, 1.000000], [1.000000, 0.000000, 0.000000, 0.000000]],
    [[0.006059, 0.056285, 0.060064, 1.000000], [0.737238, 0.202745, -0.594267, -0.249441]], # thumb aux
    [[0.040416, -0.043018, 0.019345, 1.000000], [-0.290331, 0.623527, 0.663809, 0.293734]], # index aux
    [[0.039354, -0.075674, 0.047048, 1.000000], [-0.187047, 0.678062, 0.659285, 0.265683]], # middle aux
    [[0.038340, -0.090987, 0.082579, 1.000000], [-0.183037, 0.736793, 0.634757, 0.143936]], # ring aux
    [[0.031806, -0.087214, 0.121015, 1.000000], [-0.003659, 0.758407, 0.639342, 0.126678]], # pinky aux
])

def plot_pose(pose):
    xs = []
    ys = []
    zs = []
    print("Post")
    print(pose.shape)
    print(pose[27-1])
    # x,y,z coordinates of the pose
    c = pose[:,0,:3]
    # Seperate the fingers
    thumb = c[2:6]
    index = c[6:11]
    middle = c[11:16]
    ring = c[16:21]
    pinky = c[21:26]

    # Read the file format into x,y,z and build the hand
    fingers = [thumb, index, middle, ring, pinky]
    for finger in fingers:
        x = c[1][0]
        y = c[1][1]
        z = c[1][2]
        for point in finger:
            x += point[0]
            y += point[1]
            z += point[2]
            xs.append(x)
            ys.append(y)
            zs.append(z)
    
    # Plot those points
    fig = plt.figure()
    ax = fig.add_subplot(111, projection='3d', xlim=(-1, 1), ylim=(-1, 1), zlim=(-1, 1))
    ax.scatter(xs,ys,zs)
    plt.show()

plot_pose(right_pose)